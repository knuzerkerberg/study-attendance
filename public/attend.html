<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì¶œì„í•˜ê¸°</title>
</head>
<body>
  <h1>âœ… ì¶œì„í•˜ê¸°</h1>
  <form id="form">
    ì´ë¦„: <input type="text" id="name" required /><br /><br />
    <button type="submit">ì¶œì„ ì œì¶œ</button>
  </form>

  <p id="result"></p>

  <script>
    document.getElementById("form").addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = document.getElementById("name").value;
      const now = new Date();
      const time = now.toLocaleTimeString();
      const timestamp = now.toISOString();

      const latitude = (await new Promise((res, rej) =>
        navigator.geolocation.getCurrentPosition(
          (pos) => res(pos.coords.latitude),
          (err) => rej("ìœ„ì¹˜ ì •ë³´ í—ˆìš© í•„ìš”")
        )
      )).toFixed(5);

      const longitude = (await new Promise((res, rej) =>
        navigator.geolocation.getCurrentPosition(
          (pos) => res(pos.coords.longitude),
          (err) => rej("ìœ„ì¹˜ ì •ë³´ í—ˆìš© í•„ìš”")
        )
      )).toFixed(5);

      const isLate = now.getHours() >= 9 && now.getMinutes() > 10;
      const penalty = isLate ? Math.ceil(now.getMinutes() / 10) * 100 : 0;

      const log = {
        name,
        time: timestamp,
        isLate,
        penalty,
        location: { lat: latitude, lng: longitude },
      };

      // localStorageì— ê°„ë‹¨ ì €ì¥
      let logs = JSON.parse(localStorage.getItem("attendance") || "[]");
      logs.push(log);
      localStorage.setItem("attendance", JSON.stringify(logs));

      document.getElementById("result").textContent = `ì¶œì„ ì™„ë£Œ! ${time} (${isLate ? "ì§€ê°ğŸ’¸" : "ì •ì‹œ"})`;
    });
  </script>
</body>
</html>
